{% extends "layout.html" %}

{% block title %}
	{% if user.is_authenticated %}
		My Dashboard
	{% else %}
		Home
	{% endif %}
{% endblock %}

{% block aboveNav %}
<div class="container" style="text-align: center; font-weight: bolder;">
	<h1 class="text-center">
		{% if user.is_authenticated %}
		My Profile
		{% else %}
		Schedule Optimiser
		{% endif %}
	</h1>
</div>
{% endblock %}

<!-- INHERIT FROM DAD'S CODE -->

{% block main %}
<br>
<div>
	{% if user.is_authenticated %}
		{% if ConferenceData %}
		<div>
			<h3>
			<p style="text-align: right; font-style: italic; font-weight: bold; font-size: medium;">
				Username: {{ userData.username }}
				<br>
				Account type: {{ userData.type.capitalize() }}
			</p>
			</h3>
			<br>
			<table style="width:100%;">
				<tr style="text-align: center; font-weight: bold;">
					<td>
						My Upcoming Conference:
						<br><h2>{{ ConferenceData["confName"] }}</h2>
					</td>
					<td>
						{% if userData.type == 'host' %}
							<button style="text-align: center;" class="btn btn-primary" href="/edit-conference/{{ ConferenceData['confId'] }}">Edit Conference</button>
						{% else %}
							<a href="/preview-talks/{{ ConferenceData['confId'] }}"><button style="text-align: center;" class="btn btn-primary">Select Talks</button></a>
						{% endif %}
					</td>
					<td>
						Start Date: <br><h3>{{ ConferenceData["confStart"].strftime('%d-%m-%Y') }}</h3>
					</td>
				</tr>
			</table>
		</div>
		<br><br>
		<div>
			<!-- TODO Perhaps a 'See Entire Schedule' button, and a scroll between days option for hosts -->
			<!-- A table in the left half of another table (of 1 row and 2 columns) -->
			<!-- The other half of the 'super' table holds the schedule of the user -->
			<table style="width:100%;">
				<tr>
					<td>
						<!-- Conference information and buttons -->
						<table style="width:50%; align-self:self-start; align-items:self-start;" cellpadding="5" cellspacing="4">
							<tr>
								<td>
									Sign Up Deadline: {{ ConferenceData["delegSignUpDeadline"].strftime('%d-%m-%Y') }}
								</td>
							</tr>
							<br>
							<tr style="font-weight: bold;">
								<td>
									→ Start Date: {{ ConferenceData["confStart"].strftime('%d-%m-%Y') }}
								</td>
							</tr>
							<br>
							<tr style="font-weight: bold;">	
								<td>
									→ End Date: {{ ConferenceData["confEnd"].strftime('%d-%m-%Y') }}
								</td>
							</tr>
							<tr>
								<td>
									{% if userData.type == 'host' %}
									<form action="/terminate-conference/{{ ConferenceData['confId'] }}" method="POST" onsubmit="return confirmSubmit(1)">
										<button style="text-align: center;" class="btn btn-danger" type="subtmit">Terminate Conference</button>
									</form>
									{% else %}
									<form action="/cancel-registration/{{ ConferenceData['confId'] }}" method="POST" onsubmit="confirmSubmit()">
										<button style="text-align: center;" class="btn btn-danger" type="subtmit">Cancel Registration</button>
									</form>
									{% endif %}
								</td>
							</tr>
						</table>
					</td>
					<td>
						<div id="SCHEDULE">
							<!-- Conference schedule for the day -->
							{% if schedule %}
							<td>
								<h3 style="font-weight: bold;">
									Schedule of Talks
									{% if ConferenceData['currentDay'] %}
										: Day {{ ConferenceData['currentDay'] }}
									{% endif %}
								</h3>
								<!-- TABLE OF TALKS START -->
								<table class="schedule" style="color:#33ccff;" border="3" cellpadding="8" cellspacing="5" columns="{{ ConferenceData['numSessions'] + 1}}">
									{% if userData.type == "delegate" %}
										<thead style="text-align: center;">
											<td>
												<p style="font-weight:bold;">
													Time
												</p>
											</td>
											<td>
												<p style="font-weight:bold;">
													Talk
												</p>
											</td>
											<td>
												<p style="font-weight:bold;">
													Speaker
												</p>
											</td>
										</thead>
									{% else %}
										<thead style="text-align: center;">
											<td>
												<p style="font-weight:bold;">
													Time
												</p>
											</td>
											{% for i in range(ConferenceData['numSessions']) %}
											<td>
												<p style="font-weight:bold;"> <!-- So for a 3 session conference there would be 4 columns in this table -->
													Session {{ i + 1 }}
												</p>
											</td>
											{% endfor %}
										</thead>
										{% for timing, slots in schedule[currentDay].items() %}
											<tr style="vertical-align: top;"> <!-- The time slot -->
												<td>
													{{ timing }}
												</td>
											{% if not slots is string %}
												{% for thing in slots %}
													<td>
														{% if thing != 'None' %}
														<span style="font-style: italic;">
															"{{ thing[1] }}"
														</span> by {{ thing[2] }}
														{% else %}
														<div>
															No talk scheduled
														</div>
														{% endif %}
													</td>
												{% endfor %}
											{% else %}
												<td style="font-style: italic; font-weight: bold;">
													{{ slots }}
												</td>
											{% endif %}
											</tr>
										{% endfor %}
									{% endif %}
								</table>
								<!-- TABLE OF TALKS END -->
							</td>
							{% endif %}
						</div>
					</td>
				</tr>
			</table>
		</div>
		{% else %}
			{% if userData.type.capitalize() == "Delegate" %}
				<p style="text-align: center;">Find a Conference <a style="font-weight: bold;" href="/find-conference">Here</a> to get started.</p>
			{% else %}
				<p style="text-align: center;">Maybe you want to create a conference? Click <a style="font-weight: bold;" href="/create-conference-1">Here</a> to get started.</p>
			{% endif %}
		{% endif %}
	{% else %}
		<p style="text-align: center;">Please login to our system <a style="font-weight: bold;" href="/login">Here</a> to get started.</p>
	{% endif %}
</div>
<script>
    function confirmSubmit(type) {
        // Display a confirmation dialog
		var result = false
		if (type == 1) { // Conference termination
			var result = confirm("Are you sure you want to terminate this conference?");
		} else { // Registration cancellation
			var result = confirm("Are you sure you do not want to attend?");
		}
    
        // If the user clicks "OK," proceed with the form submission
        return result;
    }
</script>
{% endblock %}